{
  "Description": "Detects potential Active Directory enumeration via LDAP\n\nAuthor: Adeem Mawani\nSigma Repository: [GitHub](https://github.com/SigmaHQ/sigma)",
  "ID": "31d68132-4038-47c7-8f8e-635a39a7c174",
  "InsertDate": "2025-01-25T21:20:08Z",
  "LastUpdateDate": "2025-01-25T21:20:08Z",
  "Level": "medium",
  "Name": "Potential Active Directory Reconnaissance/Enumeration Via LDAP",
  "Query": "sourcetype='windows-ldap' eql select * from _source_ where (((eventid = '30' and (searchfilter like '%(groupType:1.2.840.113556.1.4.803:=2147483648)%' or searchfilter like '%(groupType:1.2.840.113556.1.4.803:=2147483656)%' or searchfilter like '%(groupType:1.2.840.113556.1.4.803:=2147483652)%' or searchfilter like '%(groupType:1.2.840.113556.1.4.803:=2147483650)%' or searchfilter like '%(sAMAccountType=805306369)%' or searchfilter like '%(sAMAccountType=805306368)%' or searchfilter like '%(sAMAccountType=536870913)%' or searchfilter like '%(sAMAccountType=536870912)%' or searchfilter like '%(sAMAccountType=268435457)%' or searchfilter like '%(sAMAccountType=268435456)%' or searchfilter like '%(objectCategory=groupPolicyContainer)%' or searchfilter like '%(objectCategory=organizationalUnit)%' or searchfilter like '%(objectCategory=Computer)%' or searchfilter like '%(objectCategory=nTDSDSA)%' or searchfilter like '%(objectCategory=server)%' or searchfilter like '%(objectCategory=domain)%' or searchfilter like '%(objectCategory=person)%' or searchfilter like '%(objectCategory=group)%' or searchfilter like '%(objectCategory=user)%' or searchfilter like '%(objectClass=trustedDomain)%' or searchfilter like '%(objectClass=computer)%' or searchfilter like '%(objectClass=server)%' or searchfilter like '%(objectClass=group)%' or searchfilter like '%(objectClass=user)%' or searchfilter like '%(primaryGroupID=521)%' or searchfilter like '%(primaryGroupID=516)%' or searchfilter like '%(primaryGroupID=515)%' or searchfilter like '%(primaryGroupID=512)%' or searchfilter like '%Domain Admins%' or searchfilter like '%objectGUID=\\*%' or searchfilter like '%(schemaIDGUID=\\*)%' or searchfilter like '%admincount=1%')) and  not (eventid = '30' and (searchfilter like '%(domainSid=*)%' or searchfilter like '%(objectSid=*)%'))) or (eventid = '30' and (searchfilter like '%(userAccountControl:1.2.840.113556.1.4.803:=4194304)%' or searchfilter like '%(userAccountControl:1.2.840.113556.1.4.803:=2097152)%' or searchfilter like '%!(userAccountControl:1.2.840.113556.1.4.803:=1048574)%' or searchfilter like '%(userAccountControl:1.2.840.113556.1.4.803:=524288)%' or searchfilter like '%(userAccountControl:1.2.840.113556.1.4.803:=65536)%' or searchfilter like '%(userAccountControl:1.2.840.113556.1.4.803:=8192)%' or searchfilter like '%(userAccountControl:1.2.840.113556.1.4.803:=544)%' or searchfilter like '%!(UserAccountControl:1.2.840.113556.1.4.803:=2)%' or searchfilter like '%msDS-AllowedToActOnBehalfOfOtherIdentity%' or searchfilter like '%msDS-AllowedToDelegateTo%' or searchfilter like '%msDS-GroupManagedServiceAccount%' or searchfilter like '%(accountExpires=9223372036854775807)%' or searchfilter like '%(accountExpires=0)%' or searchfilter like '%(adminCount=1)%' or searchfilter like '%ms-MCS-AdmPwd%')) or (eventid = '30' and searchfilter = '(objectclass=\\*)' and (distinguishedname like '%CN=Domain Admins%' or distinguishedname like '%CN=Enterprise Admins%' or distinguishedname like '%CN=Group Policy Creator Owners%')))",
  "Tags": [
    "attack.discovery",
    "attack.t1069.002",
    "attack.t1087.002",
    "attack.t1482"
  ],
  "Version": "0.1"
}