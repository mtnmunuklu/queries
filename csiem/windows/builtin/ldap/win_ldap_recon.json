{
  "Description": "Detects potential Active Directory enumeration via LDAP\n\nAuthor: Adeem Mawani\nSigma Repository: [GitHub](https://github.com/SigmaHQ/sigma)",
  "ID": "31d68132-4038-47c7-8f8e-635a39a7c174",
  "InsertDate": "2025-01-21T09:27:27Z",
  "LastUpdateDate": "2025-01-21T09:27:27Z",
  "Level": "medium",
  "Name": "Potential Active Directory Reconnaissance/Enumeration Via LDAP",
  "Query": "sourcetype='windows-ldap' eql select * from _source_ where (((eventid = '30' and (searchfilter like '%(grouptype:1.2.840.113556.1.4.803:=2147483648)%' or searchfilter like '%(grouptype:1.2.840.113556.1.4.803:=2147483656)%' or searchfilter like '%(grouptype:1.2.840.113556.1.4.803:=2147483652)%' or searchfilter like '%(grouptype:1.2.840.113556.1.4.803:=2147483650)%' or searchfilter like '%(samaccounttype=805306369)%' or searchfilter like '%(samaccounttype=805306368)%' or searchfilter like '%(samaccounttype=536870913)%' or searchfilter like '%(samaccounttype=536870912)%' or searchfilter like '%(samaccounttype=268435457)%' or searchfilter like '%(samaccounttype=268435456)%' or searchfilter like '%(objectcategory=grouppolicycontainer)%' or searchfilter like '%(objectcategory=organizationalunit)%' or searchfilter like '%(objectcategory=computer)%' or searchfilter like '%(objectcategory=ntdsdsa)%' or searchfilter like '%(objectcategory=server)%' or searchfilter like '%(objectcategory=domain)%' or searchfilter like '%(objectcategory=person)%' or searchfilter like '%(objectcategory=group)%' or searchfilter like '%(objectcategory=user)%' or searchfilter like '%(objectclass=trusteddomain)%' or searchfilter like '%(objectclass=computer)%' or searchfilter like '%(objectclass=server)%' or searchfilter like '%(objectclass=group)%' or searchfilter like '%(objectclass=user)%' or searchfilter like '%(primarygroupid=521)%' or searchfilter like '%(primarygroupid=516)%' or searchfilter like '%(primarygroupid=515)%' or searchfilter like '%(primarygroupid=512)%' or searchfilter like '%domain admins%' or searchfilter like '%objectguid=\\*%' or searchfilter like '%(schemaidguid=\\*)%' or searchfilter like '%admincount=1%')) and  not (eventid = '30' and (searchfilter like '%(domainsid=*)%' or searchfilter like '%(objectsid=*)%'))) or (eventid = '30' and (searchfilter like '%(useraccountcontrol:1.2.840.113556.1.4.803:=4194304)%' or searchfilter like '%(useraccountcontrol:1.2.840.113556.1.4.803:=2097152)%' or searchfilter like '%!(useraccountcontrol:1.2.840.113556.1.4.803:=1048574)%' or searchfilter like '%(useraccountcontrol:1.2.840.113556.1.4.803:=524288)%' or searchfilter like '%(useraccountcontrol:1.2.840.113556.1.4.803:=65536)%' or searchfilter like '%(useraccountcontrol:1.2.840.113556.1.4.803:=8192)%' or searchfilter like '%(useraccountcontrol:1.2.840.113556.1.4.803:=544)%' or searchfilter like '%!(useraccountcontrol:1.2.840.113556.1.4.803:=2)%' or searchfilter like '%msds-allowedtoactonbehalfofotheridentity%' or searchfilter like '%msds-allowedtodelegateto%' or searchfilter like '%msds-groupmanagedserviceaccount%' or searchfilter like '%(accountexpires=9223372036854775807)%' or searchfilter like '%(accountexpires=0)%' or searchfilter like '%(admincount=1)%' or searchfilter like '%ms-mcs-admpwd%')) or (eventid = '30' and searchfilter = '(objectclass=\\*)' and (distinguishedname like '%cn=domain admins%' or distinguishedname like '%cn=enterprise admins%' or distinguishedname like '%cn=group policy creator owners%')))",
  "Tags": [
    "attack.discovery",
    "attack.t1069.002",
    "attack.t1087.002",
    "attack.t1482"
  ],
  "Version": "0.1"
}