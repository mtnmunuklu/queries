{
  "Description": "Detects the execution of PingCastle, a tool designed to quickly assess the Active Directory security level via a script located in a potentially suspicious or uncommon location.\n\n\nAuthor: Nasreddine Bencherchali (Nextron Systems), X__Junior (Nextron Systems)\nSigma Repository: [GitHub](https://github.com/SigmaHQ/sigma)",
  "ID": "b37998de-a70b-4f33-b219-ec36bf433dc0",
  "InsertDate": "2025-01-21T09:29:19Z",
  "LastUpdateDate": "2025-01-21T09:29:19Z",
  "Level": "high",
  "Name": "PUA - PingCastle Execution From Potentially Suspicious Parent",
  "Query": "sourcetype='windows-sysmon' eql select * from _source_ where (((parent_command_line like '%.bat%' or parent_command_line like '%.chm%' or parent_command_line like '%.cmd%' or parent_command_line like '%.hta%' or parent_command_line like '%.htm%' or parent_command_line like '%.html%' or parent_command_line like '%.js%' or parent_command_line like '%.lnk%' or parent_command_line like '%.ps1%' or parent_command_line like '%.vbe%' or parent_command_line like '%.vbs%' or parent_command_line like '%.wsf%') or (parent_command_line like '%:\\perflogs\\%' or parent_command_line like '%:\\temp\\%' or parent_command_line like '%:\\users\\public\\%' or parent_command_line like '%:\\windows\\temp\\%' or parent_command_line like '%\\appdata\\local\\temp%' or parent_command_line like '%\\appdata\\roaming\\%' or parent_command_line like '%\\temporary internet%') or ((parent_command_line like '%:\\users\\%' and parent_command_line like '%\\favorites\\%') and (parent_command_line like '%:\\users\\%' and parent_command_line like '%\\favourites\\%') and (parent_command_line like '%:\\users\\%' and parent_command_line like '%\\contacts\\%'))) and (parent_command_line like '%.bat%' or parent_command_line like '%.chm%' or parent_command_line like '%.cmd%' or parent_command_line like '%.hta%' or parent_command_line like '%.htm%' or parent_command_line like '%.html%' or parent_command_line like '%.js%' or parent_command_line like '%.lnk%' or parent_command_line like '%.ps1%' or parent_command_line like '%.vbe%' or parent_command_line like '%.vbs%' or parent_command_line like '%.wsf%') and (process_path like '%\\pingcastle.exe' and original_file_name = 'pingcastle.exe' and product = 'ping castle' and (command like '%--scanner aclcheck%' or command like '%--scanner antivirus%' or command like '%--scanner computerversion%' or command like '%--scanner foreignusers%' or command like '%--scanner laps_bitlocker%' or command like '%--scanner localadmin%' or command like '%--scanner nullsession%' or command like '%--scanner nullsession-trust%' or command like '%--scanner oxidbindings%' or command like '%--scanner remote%' or command like '%--scanner share%' or command like '%--scanner smb%' or command like '%--scanner smb3querynetwork%' or command like '%--scanner spooler%' or command like '%--scanner startup%' or command like '%--scanner zerologon%') and command like '%--no-enum-limit%' and (command like '%--healthcheck%' and command like '%--level full%') and (command like '%--healthcheck%' and command like '%--server %')))",
  "Tags": [
    "attack.reconnaissance",
    "attack.t1595"
  ],
  "Version": "0.1"
}