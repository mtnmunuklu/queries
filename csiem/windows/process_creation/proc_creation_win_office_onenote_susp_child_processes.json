{
  "Description": "Detects suspicious child processes of the Microsoft OneNote application. This may indicate an attempt to execute malicious embedded objects from a .one file.\n\nAuthor: Tim Rauch (Nextron Systems), Nasreddine Bencherchali (Nextron Systems), Elastic (idea)\nSigma Repository: [GitHub](https://github.com/SigmaHQ/sigma)",
  "ID": "c27515df-97a9-4162-8a60-dc0eeb51b775",
  "InsertDate": "2025-01-21T09:28:46Z",
  "LastUpdateDate": "2025-01-21T09:28:46Z",
  "Level": "high",
  "Name": "Suspicious Microsoft OneNote Child Process",
  "Query": "sourcetype='windows-sysmon' eql select * from _source_ where (parent_process_path like '%\\onenote.exe' and (((original_file_name = 'bitsadmin.exe' or original_file_name = 'certoc.exe' or original_file_name = 'certutil.exe' or original_file_name = 'cmd.exe' or original_file_name = 'cmstp.exe' or original_file_name = 'cscript.exe' or original_file_name = 'curl.exe' or original_file_name = 'hh.exe' or original_file_name = 'ieexec.exe' or original_file_name = 'installutil.exe' or original_file_name = 'javaw.exe' or original_file_name = 'microsoft.workflow.compiler.exe' or original_file_name = 'msdt.exe' or original_file_name = 'mshta.exe' or original_file_name = 'msiexec.exe' or original_file_name = 'msxsl.exe' or original_file_name = 'odbcconf.exe' or original_file_name = 'pcalua.exe' or original_file_name = 'powershell.exe' or original_file_name = 'regasm.exe' or original_file_name = 'regsvcs.exe' or original_file_name = 'regsvr32.exe' or original_file_name = 'rundll32.exe' or original_file_name = 'schtasks.exe' or original_file_name = 'scriptrunner.exe' or original_file_name = 'wmic.exe' or original_file_name = 'workfolders.exe' or original_file_name = 'wscript.exe') and (process_path like '%\\appvlp.exe' or process_path like '%\\bash.exe' or process_path like '%\\bitsadmin.exe' or process_path like '%\\certoc.exe' or process_path like '%\\certutil.exe' or process_path like '%\\cmd.exe' or process_path like '%\\cmstp.exe' or process_path like '%\\control.exe' or process_path like '%\\cscript.exe' or process_path like '%\\curl.exe' or process_path like '%\\forfiles.exe' or process_path like '%\\hh.exe' or process_path like '%\\ieexec.exe' or process_path like '%\\installutil.exe' or process_path like '%\\javaw.exe' or process_path like '%\\mftrace.exe' or process_path like '%\\microsoft.workflow.compiler.exe' or process_path like '%\\msbuild.exe' or process_path like '%\\msdt.exe' or process_path like '%\\mshta.exe' or process_path like '%\\msidb.exe' or process_path like '%\\msiexec.exe' or process_path like '%\\msxsl.exe' or process_path like '%\\odbcconf.exe' or process_path like '%\\pcalua.exe' or process_path like '%\\powershell.exe' or process_path like '%\\pwsh.exe' or process_path like '%\\regasm.exe' or process_path like '%\\regsvcs.exe' or process_path like '%\\regsvr32.exe' or process_path like '%\\rundll32.exe' or process_path like '%\\schtasks.exe' or process_path like '%\\scrcons.exe' or process_path like '%\\scriptrunner.exe' or process_path like '%\\sh.exe' or process_path like '%\\svchost.exe' or process_path like '%\\verclsid.exe' or process_path like '%\\wmic.exe' or process_path like '%\\workfolders.exe' or process_path like '%\\wscript.exe')) or (process_path like '%\\explorer.exe' and (command like '%.hta%' or command like '%.vb%' or command like '%.wsh%' or command like '%.js%' or command like '%.ps%' or command like '%.scr%' or command like '%.pif%' or command like '%.bat%' or command like '%.cmd%')) or (process_path like '%\\appdata\\%' or process_path like '%\\users\\public\\%' or process_path like '%\\programdata\\%' or process_path like '%\\windows\\tasks\\%' or process_path like '%\\windows\\temp\\%' or process_path like '%\\windows\\system32\\tasks\\%')) and  not ((process_path like '%\\appdata\\local\\microsoft\\teams\\current\\teams.exe' and command like '%-embedding') or (process_path like '%\\appdata\\local\\microsoft\\onedrive\\%' and process_path like '%\\filecoauth.exe' and command like '%-embedding')))",
  "Tags": [
    "attack.t1566",
    "attack.t1566.001",
    "attack.initial-access"
  ],
  "Version": "0.1"
}