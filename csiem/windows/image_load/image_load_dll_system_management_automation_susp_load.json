{
  "Description": "Detects loading of essential DLLs used by PowerShell by non-PowerShell process.\nDetects behavior similar to meterpreter's \"load powershell\" extension.\n\n\nAuthor: Tom Kern, oscd.community, Natalia Shornikova, Tim Shelton, Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\nSigma Repository: [GitHub](https://github.com/SigmaHQ/sigma)",
  "ID": "092bc4b9-3d1d-43b4-a6b4-8c8acd83522f",
  "InsertDate": "2025-01-21T09:27:49Z",
  "LastUpdateDate": "2025-01-21T09:27:49Z",
  "Level": "medium",
  "Name": "PowerShell Core DLL Loaded By Non PowerShell Process",
  "Query": "sourcetype='windows-sysmon' eql select * from _source_ where ((description = 'system.management.automation' and original_file_name = 'system.management.automation.dll' and (image_loaded like '%\\system.management.automation.dll' or image_loaded like '%\\system.management.automation.ni.dll')) and  not ((process_path like '%:\\program files\\powershell\\7\\pwsh.exe' or process_path like '%:\\windows\\system32\\dsac.exe' or process_path like '%:\\windows\\system32\\remotefxvgpudisablement.exe' or process_path like '%:\\windows\\system32\\runscripthelper.exe' or process_path like '%:\\windows\\system32\\sdiagnhost.exe' or process_path like '%:\\windows\\system32\\servermanager.exe' or process_path like '%:\\windows\\system32\\syncappvpublishingserver.exe' or process_path like '%:\\windows\\system32\\windowspowershell\\v1.0\\powershell_ise.exe' or process_path like '%:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe' or process_path like '%:\\windows\\system32\\winrshost.exe' or process_path like '%:\\windows\\system32\\wsmprovhost.exe' or process_path like '%:\\windows\\syswow64\\windowspowershell\\v1.0\\powershell_ise.exe' or process_path like '%:\\windows\\syswow64\\windowspowershell\\v1.0\\powershell.exe' or process_path like '%:\\windows\\syswow64\\winrshost.exe' or process_path like '%:\\windows\\syswow64\\wsmprovhost.exe') or ((process_path like '%:\\windows\\microsoft.net\\framework\\%' or process_path like '%:\\windows\\microsoft.net\\framework64\\%') and process_path like '%\\mscorsvw.exe')) and  not (((process_path like '%:\\program files (x86)\\microsoft sql server management studio%' or process_path like '%:\\program files\\microsoft sql server management studio%') and process_path like '%\\ide\\ssms.exe') or process_path like '%\\citrix\\configsync\\configsyncrun.exe' or process_path like '%:\\programdata\\chocolatey\\choco.exe%' or (process_path like '%:\\windows\\temp\\asgard2-agent\\%' and (process_path like '%\\thor64.exe' or process_path like '%\\thor.exe')) or ((process_path like '%:\\program files (x86)\\microsoft sql server\\%' or process_path like '%:\\program files\\microsoft sql server\\%') and process_path like '%\\tools\\binn\\sqlps.exe') or (process_path like '%:\\program files (x86)\\microsoft visual studio\\%' or process_path like '%:\\program files\\microsoft visual studio\\%') or process_path = 'null'))",
  "Tags": [
    "attack.t1059.001",
    "attack.execution"
  ],
  "Version": "0.1"
}