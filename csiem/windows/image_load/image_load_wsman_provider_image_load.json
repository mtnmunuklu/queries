{
  "Description": "Detects signs of potential use of the WSMAN provider from uncommon processes locally and remote execution.\n\nAuthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\nSigma Repository: [GitHub](https://github.com/SigmaHQ/sigma)",
  "ID": "ad1f4bb9-8dfb-4765-adb6-2a7cfb6c0f94",
  "InsertDate": "2025-01-21T09:27:54Z",
  "LastUpdateDate": "2025-01-21T09:27:54Z",
  "Level": "medium",
  "Name": "Suspicious WSMAN Provider Image Loads",
  "Query": "sourcetype='windows-sysmon' eql select * from _source_ where ((((image_loaded like '%\\wsmsvc.dll' or image_loaded like '%\\wsmauto.dll' or image_loaded like '%\\microsoft.wsman.management.ni.dll') and (original_file_name = 'wsmsvc.dll' or original_file_name = 'wsmanautomation.dll' or original_file_name = 'microsoft.wsman.management.dll')) or (process_path like '%\\svchost.exe' and original_file_name = 'wsmwmipl.dll')) and  not (((process_path like 'c:\\windows\\microsoft.net\\framework64\\v%' or process_path like 'c:\\windows\\microsoft.net\\framework\\v%') and process_path like '%\\mscorsvw.exe') or process_path like 'c:\\program files\\citrix\\%' or process_path like 'c:\\$windows.~bt\\sources\\%' or (command like '%svchost.exe -k netsvcs -p -s bits%' or command like '%svchost.exe -k graphicsperfsvcgroup -s graphicsperfsvc%' or command like '%svchost.exe -k networkservice -p -s wecsvc%' or command like '%svchost.exe -k netsvcs%') or (process_path = 'c:\\windows\\system32\\configure-smremoting.exe' or process_path = 'c:\\windows\\system32\\servermanager.exe') or process_path like 'c:\\windows\\temp\\asgard2-agent\\%' or process_path like '%\\powershell_ise.exe' or (process_path like '%\\powershell.exe' or process_path like '%c:\\windows\\system32\\sdiagnhost.exe' or process_path like '%c:\\windows\\system32\\services.exe')) and  not (process_path like '%\\svchost.exe' and command = 'null'))",
  "Tags": [
    "attack.execution",
    "attack.t1059.001",
    "attack.lateral-movement",
    "attack.t1021.003"
  ],
  "Version": "0.1"
}